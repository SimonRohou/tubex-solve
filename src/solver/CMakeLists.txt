# ==================================================================
#  tubex-lib - cmake configuration file
# ==================================================================


# Headers stored into an include directory

  set(HEADERS_DIR ${CMAKE_CURRENT_BINARY_DIR}/../../include)
  file(MAKE_DIRECTORY ${HEADERS_DIR})
  include_directories(${HEADERS_DIR})


# Sources

  file(GLOB_RECURSE SRC ${TUBELIB_SRC_DIR} "tubex_*.cpp")
  file(GLOB_RECURSE HEADERS ${TUBELIB_SRC_DIR} "tubex_*.h")
  file(COPY ${HEADERS} DESTINATION ${HEADERS_DIR})
  add_library(tubex-solver ${SRC})
  target_link_libraries(tubex-solver ${LIBS} tubex-core)


# Write Header tubex-solver.h

  if(NOT EXISTS ${TUBELIB_BUILD_DIR}/include/tubex-solver.h)
    file(GLOB_RECURSE TUBEX_HEADERS ${TUBELIB_SRC_DIR} "tubex_*.h" "vibes.h")
    file(APPEND ${TUBELIB_BUILD_DIR}/include/tubex-solver.h "// This file is automatically generated\n")
    foreach(full_filename ${TUBEX_HEADERS})
      get_filename_component(filename ${full_filename} NAME)
      file(APPEND "${TUBELIB_BUILD_DIR}/include/tubex-solver.h" "#include \"${filename}\"\n")
    endforeach(full_filename)
  endif()


# Install

  install(FILES ${HEADERS} DESTINATION "include/tubex-solver")
  install(TARGETS tubex-solver DESTINATION lib)